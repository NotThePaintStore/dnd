<!DOCTYPE html>
<html>
<head>
    <meta X-UA-Compatible=true>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Online Monster Manual</title>
    <link rel="icon" href="favicon.ico">

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
    <link rel="stylesheet" href="custom.css">

    <link rel="import" href="src/top-stats.html">
    <link rel="import" href="src/creature-heading.html">
    <link rel="import" href="src/abilities-block.html">
    <link rel="import" href="src/property-block.html">
    <link rel="import" href="src/property-line.html">
    <link rel="import" href="src/stat-block.html">

</head>
<body>
  <nav class="navbar navbar-fixed-top navbar-dark bg-dark">
    <div class="container-fluid">
      <div class="navbar-header">
        <a class="navbar-brand" href="#">Online Monster Manual</a>
      </div>
      <div id="navbar" class="navbar">
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" id="searchbar" type="text" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form>
      </div>
    </div>
  </nav>
  <!--Main Container-->
  <div class="container-fluid">
    <div class="row">
      <!--Sidebar-->
      <nav class="nav sidebar flex-column bg-dark d-block col-sm-3 col-md-2" id="sidebar"></nav>
      <!--End Sidebar-->
      <div class="container-fluid main col-sm-9 col-md-10 bg-light">
        <!--Alert Box
        <div class="alert alert-danger alert-dismissible" role="alert">
          <button type="button" class="close" data-dismiss="alert" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
          That monster was not found! (Double-check your spelling.)
        </div>
        End Alert Box-->
        <div id="dnd" class="row mt-3"></div>
      </div>
    </div>
  </div>
  <!--End Container-->
  <script id="template" type="text/ractive">
    {{#if name}}
    <div class="col-sm-5 col-md-12 col-lg-5">
      <div class="row container">
        <img class="img-fluid mx-auto" src={{image}}/>
      </div>
      <div class="row container">
        <stat-block>
          <creature-heading>
            <h1>{{name}}</h1>
            <h2>{{statblock.size}} {{statblock.shape}}, {{statblock.alignment}}</h2>
          </creature-heading>

          <top-stats>
            <property-line>
              <h4>Armor Class</h4>
              <p>{{statblock.ac}}</p>
            </property-line>
            <property-line>
              <h4>Hit Points</h4>
              <p>{{statblock.hp}}</p>
            </property-line>
            <property-line>
              <h4>Speed</h4>
              <p>{{statblock.speed}}</p>
            </property-line>

            <abilities-block data-str={{statblock.abilities.str}}
                             data-dex={{statblock.abilities.dex}}
                             data-con={{statblock.abilities.con}}
                             data-int={{statblock.abilities.int}}
                             data-wis={{statblock.abilities.wis}}
                             data-cha={{statblock.abilities.cha}}></abilities-block>

            {{#if statblock.save_throw}}
            <property-line>
              <h4>Saving Throws</h4>
              <p>{{statblock.save_throw}}</p>
            </property-line>
            {{/if}}
            {{#if statblock.dam_resist}}
            <property-line>
              <h4>Damage Resistances</h4>
              <p>{{statblock.dam_resist}}</p>
            </property-line>
            {{/if}}
            {{#if statblock.dam_immune}}
            <property-line>
              <h4>Damage Immunities</h4>
              <p>{{statblock.dam_immune}}</p>
            </property-line>
            {{/if}}
            {{#if statblock.con_immune}}
            <property-line>
              <h4>Condition Immunities</h4>
              <p>{{statblock.con_immune}}</p>
            </property-line>
            {{/if}}
            {{#if statblock.skills}}
            <property-line>
              <h4>Skills</h4>
              <p>{{statblock.skills}}</p>
            </property-line>
            {{/if}}
            <property-line>
              <h4>Senses</h4>
              <p>{{statblock.senses}}</p>
            </property-line>
            <property-line>
              <h4>Languages</h4>
              <p>{{statblock.languages}}</p>
            </property-line>
            <property-line>
              <h4>Challenge</h4>
              <p>{{statblock.challenge}}</p>
            </property-line>
          </top-stats>

          {{#if statblock.traits}}
          {{#each statblock.traits: num}}
          <property-block>
            <h4>{{statblock.traits[num].name}}</h4>
            <p>{{{statblock.traits[num].description}}}</p>
          </property-block>
          {{/each}}
          {{/if}}

          {{#if statblock.actions}}
          <h3>Actions</h3>
          {{#each statblock.actions: num}}
          <property-block>
            <h4>{{statblock.actions[num].name}}</h4>
            <p>{{{statblock.actions[num].description}}}</p>
          </property-block>
          {{/each}}
          {{/if}}

          {{#if statblock.legendary_actions}}
          <h3>Legendary Actions</h3>
          <p>The {{name}} can take 3 legendary actions, choosing from the options below. Only one legendary action option can be used at a time and only at the end of another creature&apos;s turn. The {{name}} regains spent legendary actions at the start of its turn.</p>
          {{#each statblock.legendary_actions: num}}
          <property-block>
            <h4>{{statblock.legendary_actions[num].name}}</h4>
            <p>{{{statblock.legendary_actions[num].description}}}</p>
          </property-block>
          {{/each}}
          {{/if}}
        </stat-block>
      </div>
    </div>
    <div class="col-sm-7 mt-3">
      <div id="description">
        <h1>{{name}}</h1>
        {{#each description: num}}
        <p><b>{{description[num].title}}</b> {{description[num].content}}</p>
        {{/each}}
      </div>
    </div>
    {{/if}}
  </script>
  <script id="template2" type="text/ractive">
    {{#each catalog: x}}
      {{#if ((typeof catalog[x]) === 'object')}}
        {{#each catalog[x]: y}}
          {{#if ((typeof catalog[x][y]) === 'object')}}
            {{#each catalog[x][y]: z}}
              <button class="btn btn-link text-light" role="link" type="button" value="{{catalog[x][y][z]}}">{{catalog[x][y][z]}}</button>
            {{/each}}
          {{else}}
            <button class="btn btn-link text-light" role="link" type="button" value="{{catalog[x][y]}}">{{catalog[x][y]}}</button>
          {{/if}}
        {{/each}}
      {{else}}
        <button class="btn btn-link text-light" role="link" type="button" value="{{catalog[x]}}">{{catalog[x]}}</button>
      {{/if}}
    {{/each}}
  </script>
  <script src="https://cdn.jsdelivr.net/npm/ractive"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/js/bootstrap.min.js"></script>
  <script>
    Ractive.DEBUG = false;
    var ractive = new Ractive({
      el: '#dnd',
      template: '#template',
      data: {}
    });

    var ractive2 = new Ractive({
      el: '#sidebar',
      template: '#template2',
      data: {}
    });

    $(document).ready(function() {
      $.getJSON("catalog.json", function(json) {
        ractive2.reset(json);
      });
    });

    var monster = "";

    ractive.on("newMonster", function() {
      $.getJSON(`monsters/${monster}.json`, function(json) {
        ractive.reset(json);
      });
    });

    $("form").submit(function(event) {
      event.preventDefault();
      monster = ((document.getElementById("searchbar").value).replace(/ /g, "_")).toLowerCase();
      ractive.fire("newMonster");
    });

    $("btn-link").click(function() {
      console.log("Button clicked");
      monster = $(this).val().toLowerCase();
      console.log(monster);
      ractive.fire("newMonster");
    });
  </script>
</body>
</html>
